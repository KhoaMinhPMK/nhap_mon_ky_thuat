# 📋 MỤC LỤC

| STT | Nội dung | Trang |
|:---:|:---------|:-----:|
| | **LỜI GIỚI THIỆU** | |
| | | |
| **1** | **CHƯƠNG 1: MỞ ĐẦU** | |
| 1.1 | Lí do chọn đề tài | |
| | 1.1.1 Thực trạng ngành dưa hấu Việt Nam | |
| | 1.1.2 Nỗi đau từ phân loại thủ công | |
| | 1.1.3 Rào cản của các giải pháp hiện có | |
| | 1.1.4 Giải pháp đề xuất | |
| 1.2 | Mục tiêu | |
| | 1.2.1 Mục tiêu kỹ thuật | |
| | 1.2.2 Mục tiêu về tương tác người-máy | |
| | 1.2.3 Mục tiêu lan tỏa | |
| 1.3 | Phạm vi nghiên cứu | |
| | 1.3.1 Phạm vi đối tượng | |
| | 1.3.2 Phạm vi môi trường | |
| | 1.3.3 Phạm vi công nghệ | |
| | 1.3.4 Giới hạn đề tài | |
| | | |
| **2** | **CHƯƠNG 2: NỘI DUNG** | |
| 2.1 | Cánh tay robot công nghiệp là gì? | |
| | 2.1.1 Khái niệm | |
| | 2.1.2 Cấu tạo cơ bản | |
| | 2.1.3 Phân loại theo cấu hình động học | |
| | 2.1.4 Nguyên lý điều khiển động cơ bước | |
| | 2.1.5 CNC Shield V3 và Driver động cơ bước | |
| | 2.1.6 Công tắc hành trình (Limit Switch) | |
| | 2.1.7 Relay Module và hệ thống hút chân không | |
| | 2.1.8 Hệ thống truyền động cơ khí | |
| 2.2 | Thị giác máy tính (Computer Vision) | |
| | 2.2.1 Khái niệm | |
| | 2.2.2 Quy trình xử lý ảnh trong hệ thống | |
| | 2.2.3 Các đặc trưng nhận dạng dưa hấu | |
| 2.3 | Mạng nơ-ron tích chập (CNN) | |
| | 2.3.1 Khái niệm | |
| | 2.3.2 Các lớp chính trong CNN | |
| | 2.3.3 Quá trình huấn luyện | |
| 2.4 | Lập trình kéo thả Blockly | |
| | 2.4.1 Giới thiệu Blockly | |
| | 2.4.2 Ưu điểm của Blockly | |
| | 2.4.3 Các khối lệnh tùy chỉnh trong đề tài | |
| 2.5 | Chatbot AI trong nông nghiệp | |
| | 2.5.1 Xu hướng ứng dụng | |
| | 2.5.2 Mô hình ngôn ngữ lớn (LLM) | |
| | 2.5.3 Các tính năng Chatbot | |
| 2.6 | Giao thức truyền thông | |
| | 2.6.1 Serial Communication (UART) | |
| | 2.6.2 WebSocket | |
| | 2.6.3 REST API | |
| 2.7 | Vai trò và ứng dụng của cánh tay robot | |
| | 2.7.1 Vai trò trong công nghiệp hiện đại | |
| | 2.7.2 Ứng dụng trong nông nghiệp | |
| 2.8 | Thách thức và tương lai của cánh tay robot | |
| | 2.8.1 Những thách thức hiện tại | |
| | 2.8.2 Xu hướng tương lai | |
| | 2.8.3 Đóng góp của đề tài | |
| | | |
| **3** | **CHƯƠNG 3: TRÌNH BÀY SẢN PHẨM** | |
| 3.1 | Nguyên liệu và dụng cụ chế tạo | |
| | 3.1.1 Tổng quan kiến trúc hệ thống | |
| | 3.1.2 Danh sách linh kiện | |
| | 3.1.3 Thiết kế khung robot (in 3D) | |
| | 3.1.4 Sơ đồ kết nối điện | |
| 3.2 | Các bước thực hiện | |
| | 3.2.1 Xây dựng phần mềm Backend | |
| | 3.2.2 Xây dựng Mobile App | |
| | 3.2.3 Lập trình Arduino Firmware | |
| | | |
| **4** | **CHƯƠNG 4: KẾT LUẬN** | |
| 4.1 | Kết quả đạt được | |
| | 4.1.1 Về mặt kỹ thuật | |
| | 4.1.2 Về mặt ứng dụng thực tiễn | |
| | 4.1.3 Về mặt giáo dục và lan tỏa | |
| 4.2 | Hạn chế | |
| | 4.2.1 Hạn chế về phần cứng | |
| | 4.2.2 Hạn chế về phần mềm | |
| | 4.2.3 Hạn chế về triển khai thực tế | |
| 4.3 | Hướng phát triển | |
| | 4.3.1 Cải tiến ngắn hạn (3-6 tháng) | |
| | 4.3.2 Phát triển trung hạn (6-12 tháng) | |
| | 4.3.3 Tầm nhìn dài hạn (1-3 năm) | |
| | 4.3.4 Đóng góp cho cộng đồng | |
| 4.4 | Lời kết | |
| | | |
| | **PHỤ LỤC** | |
| | Phụ lục A: Mã nguồn Arduino | |
| | Phụ lục B: Cấu hình Backend Python | |
| | Phụ lục C: Danh sách khối Blockly | |
| | Phụ lục D: Sơ đồ chân CNC Shield V3 | |
| | | |
| | **TÀI LIỆU THAM KHẢO** | |

---

# 📖 LỜI GIỚI THIỆU

Việt Nam là một trong những quốc gia sản xuất dưa hấu lớn nhất Đông Nam Á với sản lượng đạt hơn 1,2 triệu tấn mỗi năm. Tuy nhiên, nghịch lý đáng buồn là người nông dân vẫn thường xuyên đối mặt với tình trạng "được mùa mất giá" – hệ quả trực tiếp của việc phân loại thủ công thiếu đồng nhất khiến nông sản bị ép giá khi xuất khẩu.

Các giải pháp tự động hóa hiện có như dây chuyền băng tải công nghiệp tuy hiệu quả nhưng quá cồng kềnh và đắt đỏ, không phù hợp với đặc thù sản xuất nhỏ lẻ của nông nghiệp trong nước. Trong khi đó, cánh tay robot – với ưu điểm nhỏ gọn và linh hoạt – lại đặt ra một thách thức khác: công nghệ càng hiện đại thì quy trình vận hành càng phức tạp, tạo ra rào cản vô hình ngăn cản người nông dân tiếp cận và làm chủ kỹ thuật.

Xuất phát từ thực tiễn đó, nhóm chúng em thực hiện đề tài **"Hệ thống phân loại dưa hấu sử dụng cánh tay robot tích hợp Thị giác máy tính và Chatbot AI"**. Hệ thống kết hợp ba công nghệ cốt lõi: Thị giác máy tính để nhận diện và phân loại chính xác, lập trình kéo thả Blockly để đơn giản hóa việc điều khiển robot, và Chatbot AI để chuyển đổi dữ liệu kỹ thuật thành ngôn ngữ tự nhiên dễ hiểu.

Qua đề tài này, nhóm mong muốn đóng góp một giải pháp thực tiễn, vừa nâng cao giá trị kinh tế cho nông sản Việt, vừa xóa bỏ khoảng cách công nghệ với người nông dân. Chúng em xin trân trọng giới thiệu báo cáo và rất mong nhận được sự góp ý từ quý thầy cô cùng các bạn.

---

# CHƯƠNG 1: MỞ ĐẦU

## 1.1 Lí do chọn đề tài

### 1.1.1 Thực trạng ngành dưa hấu Việt Nam

Việt Nam là một trong những quốc gia sản xuất dưa hấu lớn nhất Đông Nam Á với sản lượng đạt 1,2 triệu tấn/năm, trong đó khoảng 40% được xuất khẩu sang các thị trường Trung Quốc, Nhật Bản và Hàn Quốc (FAO, 2022). Tuy nhiên, người nông dân vẫn thường xuyên đối mặt với tình trạng "được mùa mất giá" – một vòng xoáy bế tắc đã kéo dài hàng thập kỷ.

---

### 1.1.2 Nỗi đau từ phân loại thủ công

Theo khảo sát của Viện Cây ăn quả Miền Nam (SOFRI, 2023), hơn 85% nông hộ trồng dưa hấu tại Đồng bằng sông Cửu Long vẫn thực hiện phân loại hoàn toàn bằng tay. Phương pháp này dẫn đến hàng loạt hệ lụy:

| Vấn đề | Số liệu thực tế | Nguồn |
|:-------|:---------------:|:-----:|
| Tỷ lệ sai sót phân loại | 15-25% | Báo cáo SOFRI 2023 |
| Hao hụt do dập nát | 8-12% sản lượng | Tổng cục Thống kê 2022 |
| Chi phí nhân công | 2.000-3.000 VNĐ/kg | Khảo sát thực tế Long An |
| Năng suất phân loại | 200-300 kg/người/giờ | Trung bình nông hộ |

**Thiệt hại kinh tế:** Sự thiếu đồng nhất về chất lượng khiến dưa hấu Việt Nam thường bị thương lái ép giá thấp hơn 20-30% so với giá thị trường (Hiệp hội Rau quả Việt Nam, 2023). Điển hình, trong vụ dưa Tết Nguyên đán 2024, hàng nghìn tấn dưa tại Gia Lai và Long An bị ùn ứ tại cửa khẩu Lào Cai do không đạt tiêu chuẩn đồng đều, gây thiệt hại ước tính hơn 50 tỷ đồng.

**Áp lực về sức khỏe:** Công việc phân loại đòi hỏi người lao động phải làm việc liên tục 8-10 tiếng/ngày trong điều kiện nắng nóng, dẫn đến các bệnh về xương khớp và thị lực suy giảm.

---

### 1.1.3 Rào cản của các giải pháp hiện có

| Giải pháp | Chi phí đầu tư | Hạn chế chính |
|:----------|:--------------:|:--------------|
| Dây chuyền băng tải công nghiệp | 500 triệu - 2 tỷ VNĐ | Cồng kềnh, không phù hợp nông hộ nhỏ |
| Robot phân loại nhập khẩu | 1-3 tỷ VNĐ | Đắt đỏ, khó bảo trì, cần kỹ sư vận hành |
| Hệ thống AI đơn thuần | 200-500 triệu VNĐ | Chỉ nhận diện, không có cơ cấu chấp hành |

**Nghịch lý công nghệ:** Theo báo cáo của McKinsey (2023), mặc dù 70% nông dân nhận thức được lợi ích của tự động hóa, nhưng chỉ 12% sẵn sàng áp dụng do lo ngại về độ phức tạp trong vận hành. Rào cản không chỉ nằm ở chi phí, mà còn ở khoảng cách kiến thức giữa công nghệ và người sử dụng.

---

### 1.1.4 Giải pháp đề xuất

Xuất phát từ thực tiễn trên, nhóm quyết định thực hiện đề tài với sự kết hợp ba công nghệ cốt lõi:

- **Thị giác máy tính (Computer Vision):** Chuẩn hóa chất lượng dưa xuất khẩu với độ chính xác vượt trội so với mắt người
- **Lập trình kéo thả Blockly:** Thay thế các dòng code phức tạp bằng giao diện trực quan, giảm thời gian học sử dụng từ vài tuần xuống còn vài giờ
- **Chatbot AI:** "Bình dân hóa" công nghệ, giúp bất kỳ ai cũng có thể vận hành và quản lý hệ thống hiệu quả

> **Chi phí dự kiến:** Dưới 50 triệu VNĐ – chỉ bằng 1/10 so với các giải pháp nhập khẩu, phù hợp với khả năng tài chính của đa số nông hộ Việt Nam.

---

## 1.2 Mục tiêu

### 1.2.1 Mục tiêu kỹ thuật

- Xây dựng thành công hệ thống cánh tay robot sử dụng cơ cấu thanh truyền song song (Parallel Linkage) có khả năng phân loại dưa hấu tự động
- Đạt độ chính xác phân loại ≥ 90% thông qua model Machine Learning
- Ứng dụng thuật toán xử lý ảnh và Thị giác máy tính để:
  - Nhận diện chất lượng bề mặt (vỏ đẹp, vết nứt, vết thối)
  - Phân loại thành 3 cấp độ: Premium, Second-grade, Defective
- Tốc độ xử lý tối thiểu 10-15 quả/phút, phù hợp quy mô nông hộ

---

### 1.2.2 Mục tiêu về tương tác người-máy

- Phát triển giao diện lập trình Blockly cho phép người dùng:
  - Tạo kịch bản phân loại bằng kéo thả
  - Tùy chỉnh quy trình mà không cần viết code
- Xây dựng Chatbot AI có khả năng:
  - Tổng hợp dữ liệu sản lượng theo ngày/tuần/tháng
  - Gửi báo cáo và cảnh báo bằng ngôn ngữ tự nhiên tiếng Việt
  - Trả lời các câu hỏi về tình trạng hệ thống
- Phát triển Mobile App để giám sát từ xa

---

### 1.2.3 Mục tiêu lan tỏa

- Chứng minh tính khả thi của việc ứng dụng AI vào bài toán thực tiễn nông sản Việt Nam
- Truyền tải thông điệp về "Nông nghiệp thông minh" – hiện đại nhưng gần gũi
- Tạo tiền đề để nhân rộng mô hình cho các loại nông sản khác

---

## 1.3 Phạm vi nghiên cứu

### 1.3.1 Phạm vi đối tượng

- **Đối tượng phân loại:** Dưa hấu tròn, khối lượng 2-5 kg
- **Phân loại thành 3 cấp:**

| Cấp độ | Tiêu chí | Hướng xử lý |
|:------:|:---------|:------------|
| Premium (Loại 1) | Vỏ đẹp, màu sắc đồng đều, không khuyết tật | Xuất khẩu |
| Second-grade (Loại 2) | Có vết xước nhẹ, màu không đều | Tiêu thụ nội địa |
| Defective (Lỗi) | Nứt, thối, biến dạng | Loại bỏ/Chế biến |

---

### 1.3.2 Phạm vi môi trường

- Hoạt động trong nhà với điều kiện ánh sáng ổn định
- Nhiệt độ hoạt động: 20-35°C
- Khối lượng xử lý: Phù hợp quy mô nông hộ nhỏ và vừa (500-1000 quả/ngày)

---

### 1.3.3 Phạm vi công nghệ

| Thành phần | Công nghệ sử dụng |
|:-----------|:------------------|
| Phần cứng | Arduino Uno + CNC Shield V3 + Stepper Motor NEMA 17 |
| Backend | Python Flask + WebSocket |
| Machine Learning | TensorFlow SavedModel (CNN) |
| Mobile App | React Native |
| Giao tiếp | Serial COM, REST API, WebSocket |

---

### 1.3.4 Giới hạn đề tài

- Chưa tích hợp cân điện tử để phân loại theo khối lượng
- Chưa có khả năng phân loại theo kích thước tự động
- Yêu cầu kết nối USB với máy tính (chưa có wireless)
- Model ML được huấn luyện với dataset giới hạn (~3000 ảnh)

---

# CHƯƠNG 2: NỘI DUNG

## 2.1 Cánh tay robot công nghiệp là gì?

### 2.1.1 Khái niệm

Cánh tay robot công nghiệp (Industrial Robotic Arm) là thiết bị cơ điện tử có khả năng thực hiện các chuyển động tương tự cánh tay con người, được lập trình để thực hiện các tác vụ lặp đi lặp lại với độ chính xác cao. Theo Liên đoàn Robot Quốc tế (IFR, 2023), cánh tay robot được định nghĩa là "máy móc có thể lập trình được, hoạt động tự động và có khả năng di chuyển theo nhiều trục".

### 2.1.2 Cấu tạo cơ bản

Để hiểu rõ hơn về cách robot hoạt động, trước tiên cần nắm được các thành phần cơ bản của một cánh tay robot công nghiệp:

| Thành phần | Chức năng | Áp dụng trong đề tài |
|:-----------|:----------|:-------------------|
| Đế (Base) | Cố định robot, chịu tải toàn bộ hệ thống | Khung nhựa in 3D (PLA/PETG) |
| Các khớp (Joints) | Tạo chuyển động xoay hoặc tịnh tiến | 3 khớp xoay (đế, vai, khuỷu) |
| Các khâu (Links) | Kết nối các khớp với nhau | Cánh tay nhựa in 3D + thanh truyền |
| Cơ cấu chấp hành (End Effector) | Tương tác trực tiếp với đối tượng | Giác hút chân không |
| Bộ điều khiển (Controller) | Xử lý tín hiệu, điều khiển chuyển động | Arduino Uno + CNC Shield V3 |
| Động cơ (Actuators) | Tạo lực và chuyển động | 3 động cơ bước NEMA 17 |

### 2.1.3 Phân loại theo cấu hình động học

Trong lĩnh vực robot, có nhiều cấu hình động học khác nhau, mỗi loại phù hợp với một ứng dụng cụ thể:

| Loại robot | Đặc điểm | Ứng dụng |
|:-----------|:---------|:---------|
| Cartesian (Descartes) | 3 trục tịnh tiến X-Y-Z, không gian làm việc hình hộp | Máy CNC, in 3D, pick-and-place |
| SCARA | 2 trục xoay + 1 trục tịnh tiến | Lắp ráp linh kiện điện tử |
| Articulated | Nhiều khớp xoay, linh hoạt cao | Hàn, sơn, phân loại phức tạp |
| Delta | Cấu trúc song song, tốc độ cao | Đóng gói thực phẩm |
| Parallel Linkage | Cơ cấu thanh truyền song song | Robot cánh tay nhẹ, chính xác |

**Lựa chọn của đề tài:** Sau khi cân nhắc các yếu tố về chi phí, độ phức tạp và yêu cầu ứng dụng, nhóm quyết định sử dụng robot cánh tay với cơ cấu **Parallel Linkage (Thanh truyền song song)**.

**Tại sao chọn Parallel Linkage?**

Vấn đề của robot thông thường: Động cơ cho khớp khuỷu tay thường gắn ngay trên cánh tay, làm cánh tay nặng, quán tính lớn, rung lắc khi di chuyển nhanh.

Giải pháp của thiết kế Parallel Linkage:
- Cả 2 động cơ chính (vai và khuỷu) đều nằm cố định ở thân dưới (Body Base), không gắn trên cánh tay
- Động cơ 1: Truyền động trực tiếp cho cánh tay dưới (Lower arm) qua dây đai GT2
- Động cơ 2: Truyền động cho cánh tay trên (Upper arm) thông qua hệ thống thanh truyền (Connecting rods - Pleuel)
- Động cơ 3: Điều khiển đế xoay (Base rotation) qua bánh răng

**Kết quả:** Cánh tay rất nhẹ vì không mang động cơ, di chuyển nhanh và chính xác hơn, giảm rung lắc đáng kể so với thiết kế truyền thống.

### 2.1.4 Nguyên lý điều khiển động cơ bước (Stepper Motor)

Sau khi hiểu về cấu trúc cơ khí, tiếp theo cần tìm hiểu về "cơ bắp" của robot - động cơ bước. Đây là loại động cơ điện chuyển đổi các xung điện thành chuyển động cơ học rời rạc, cho phép điều khiển vị trí chính xác mà không cần cảm biến phản hồi. Mỗi xung điện khiến rotor quay một góc cố định gọi là "bước" (step).

Công thức tính góc bước:
- Góc bước = 360° / Số bước mỗi vòng

Với động cơ NEMA 17 (1.8°/bước):
- Số bước/vòng = 360° / 1.8° = 200 bước
- Khi sử dụng microstepping 1/16: 200 × 16 = 3200 microsteps/vòng

### 2.1.5 CNC Shield V3 và Driver động cơ bước

Để điều khiển 3 động cơ bước một cách đồng bộ, nhóm sử dụng CNC Shield V3 - một board mở rộng phổ biến cho Arduino Uno. Mặc dù tên gọi "CNC Shield" gợi liên tưởng đến máy CNC, nhưng thực chất đây là board điều khiển động cơ bước đa năng, hoàn toàn phù hợp với robot cánh tay.

| Thành phần | Thông số | Chức năng |
|:-----------|:---------|:----------|
| Khe cắm Driver | 4 khe (X, Y, Z, A) | Gắn module driver A4988/DRV8825 |
| Nguồn cấp | 12-36V DC | Cấp nguồn cho động cơ |
| Chân Enable | D8 | Bật/tắt tất cả driver |
| Chân Step/Dir | D2-D7 | Điều khiển bước và hướng quay |
| Chân Limit | D9, D10, D11, D12 | Kết nối công tắc giới hạn |
| Spindle/Relay | D12, D13 | Điều khiển relay, spindle |

Driver A4988 được sử dụng trong đề tài với các thông số:
- Dòng tối đa: 2A/pha
- Microstepping: Full, 1/2, 1/4, 1/8, 1/16
- Điện áp logic: 3-5.5V
- Điện áp motor: 8-35V

### 2.1.6 Công tắc hành trình (Limit Switch)

Một vấn đề quan trọng với động cơ bước là chúng không biết vị trí thực tế của mình khi mới khởi động. Để giải quyết vấn đề này, nhóm sử dụng công tắc hành trình - công tắc cơ học dùng để xác định vị trí giới hạn và cho phép robot về vị trí gốc (Home) một cách chính xác.

| Loại | Trạng thái | Ứng dụng |
|:-----|:-----------|:---------|
| Normally Open (NO) | Hở khi không nhấn, đóng khi nhấn | Phổ biến, dễ kiểm tra lỗi dây |
| Normally Closed (NC) | Đóng khi không nhấn, hở khi nhấn | An toàn hơn (phát hiện đứt dây) |

Trong đề tài, công tắc hành trình được sử dụng tại:
- Đế xoay (Base): 1 công tắc hành trình gắn bằng 2 ốc M2 10mm + đai ốc M2
- Thân robot (Body): 2 công tắc hành trình, dùng ốc M2 10mm và đai ốc M2

Quy trình Homing:
1. Robot di chuyển chậm về hướng Home
2. Khi chạm công tắc hành trình → dừng ngay lập tức
3. Lùi lại một khoảng nhỏ
4. Di chuyển chậm lại cho đến khi chạm lần 2
5. Đặt vị trí hiện tại = 0 (gốc tọa độ)

### 2.1.7 Relay Module và hệ thống hút chân không

Sau khi robot di chuyển đến vị trí dưa hấu, cần có cơ chế để "cầm" và "thả" quả dưa. Thay vì dùng tay kẹp cơ học (dễ làm dập dưa), nhóm chọn giải pháp hút chân không - nhẹ nhàng và an toàn hơn. Để điều khiển máy bơm hút, nhóm sử dụng Relay - công tắc điện từ cho phép Arduino (5V) đóng/ngắt nguồn điện lớn hơn (12V cho bơm).

| Thông số | Giá trị |
|:---------|:--------|
| Điện áp điều khiển | 5V DC |
| Dòng kích | 15-20mA |
| Điện áp chuyển mạch | Tối đa 250V AC / 30V DC |
| Dòng chuyển mạch | Tối đa 10A |

Hệ thống hút chân không trong đề tài:
- Máy bơm chân không mini 12V
- Van điện từ (Solenoid Valve)
- Giác hút (Suction Cup) đường kính phù hợp với dưa hấu
- Relay điều khiển bật/tắt bơm

Nguyên lý hoạt động:
1. Arduino gửi tín hiệu HIGH → Relay đóng → Bơm chạy
2. Tạo áp suất âm trong giác hút
3. Dưa hấu được hút chặt vào giác
4. Di chuyển đến vị trí đích
5. Arduino gửi tín hiệu LOW → Relay mở → Bơm tắt → Thả dưa

### 2.1.8 Hệ thống truyền động cơ khí

Để truyền chuyển động từ động cơ đến các khớp robot, nhóm sử dụng hệ thống dây đai và bánh răng. So với truyền động trực tiếp, dây đai có ưu điểm êm hơn, giảm rung động và cho phép đặt động cơ xa khớp xoay.

| Thành phần | Loại sử dụng | Đặc điểm |
|:-----------|:-------------|:---------|
| Puly | GT2 20 răng | 3 cái, gắn vào trục motor |
| Dây đai | GT2 Belt 200mm (vòng kín) | 3 sợi, truyền động từ motor |
| Bạc đạn lớn | F686ZZ | Bạc đạn cầu có gờ, định vị tâm |
| Bạc đạn nhỏ | F624ZZ | Cho các khớp nối thanh truyền |
| Bạc đạn chà | 51105 | Chịu lực nén dọc trục (đế xoay) |
| Trục xoay | Ốc M6 50mm | Làm trục xoay chính cho cụm vai |

Danh sách vòng bi (Bearings):
- F686ZZ: 12 cái (dư 2 cái phòng hờ)
- F624ZZ: 8 cái (nếu làm bản Dual Support)
- 51105: 2 cái

Công thức tính khoảng di chuyển với đai GT2 + Pully 20 răng:
- Chu vi pully = 20 răng × 2mm = 40mm
- Khoảng cách = (Số bước × 40mm) / 200

---

## 2.2 Thị giác máy tính (Computer Vision)

Sau khi tìm hiểu về phần cứng robot, phần tiếp theo sẽ đi vào "bộ não" của hệ thống - công nghệ giúp robot "nhìn" và phân biệt các loại dưa hấu.

### 2.2.1 Khái niệm

Thị giác máy tính (Computer Vision) là lĩnh vực khoa học máy tính nghiên cứu cách giúp máy tính "nhìn" và "hiểu" nội dung hình ảnh hoặc video, tương tự như cách con người sử dụng mắt và não để nhận diện vật thể. Theo Szeliski (2022), thị giác máy tính bao gồm các bước: thu nhận ảnh → tiền xử lý → trích xuất đặc trưng → nhận dạng/phân loại.

### 2.2.2 Quy trình xử lý ảnh trong hệ thống

Các bước xử lý cụ thể trong đề tài:

| Bước | Kỹ thuật | Mục đích |
|:----:|:---------|:---------|
| 1 | Thu nhận (Webcam) | Chụp ảnh dưa hấu thời gian thực |
| 2 | Resize (224×224 px) | Chuẩn hóa kích thước đầu vào cho CNN |
| 3 | Normalize (÷255) | Đưa giá trị pixel về khoảng [0, 1] |
| 4 | Augmentation | Tăng cường dữ liệu huấn luyện |
| 5 | Inference | Dự đoán loại dưa hấu |

### 2.2.3 Các đặc trưng nhận dạng dưa hấu

| Đặc trưng | Mô tả | Ảnh hưởng phân loại |
|:----------|:------|:--------------------|
| Màu sắc vỏ | Xanh đậm, xanh nhạt, vàng | Premium cần màu xanh đậm đều |
| Độ bóng | Bóng mịn hay xỉn mờ | Vỏ bóng = chín đúng độ |
| Vân sọc | Độ rõ nét, đều đặn | Vân rõ = chất lượng tốt |
| Khuyết tật | Vết nứt, thối, dập | Có khuyết tật = Defective |
| Hình dạng | Tròn đều hay méo | Méo mó = Second-grade |

---

## 2.3 Mạng nơ-ron tích chập (CNN)

Vậy máy tính "học" cách phân biệt dưa hấu tốt và xấu như thế nào? Câu trả lời nằm ở Mạng nơ-ron tích chập - công nghệ đã cách mạng hóa lĩnh vực nhận dạng hình ảnh.

### 2.3.1 Khái niệm

Mạng nơ-ron tích chập (Convolutional Neural Network - CNN) là kiến trúc Deep Learning được thiết kế đặc biệt để xử lý dữ liệu có cấu trúc dạng lưới như hình ảnh. Lấy cảm hứng từ cách não người xử lý thông tin thị giác, CNN có khả năng tự động học các đặc trưng từ dữ liệu thô mà không cần trích xuất đặc trưng thủ công (LeCun et al., 2015).

### 2.3.2 Các lớp chính trong CNN

Để dễ hình dung, có thể tưởng tượng CNN như một dây chuyền xử lý ảnh qua nhiều công đoạn:

| Lớp | Chức năng | Tham số trong đề tài |
|:----|:----------|:---------------------|
| Convolutional | Trích xuất đặc trưng cục bộ | 32, 64, 128 filters; kernel 3×3 |
| Activation (ReLU) | Thêm tính phi tuyến: f(x) = max(0, x) | Sau mỗi lớp Conv2D |
| Pooling | Giảm kích thước, giữ đặc trưng quan trọng | MaxPooling 2×2 |
| Flatten | Chuyển tensor 2D thành vector 1D | Trước lớp Dense |
| Dense | Kết hợp đặc trưng để phân loại | 128 neurons, 3 outputs |
| Softmax | Chuyển output thành xác suất | 3 classes (tổng = 1) |

### 2.3.3 Quá trình huấn luyện

Hàm mất mát (Loss Function): Categorical Cross-Entropy

Thuật toán tối ưu: Adam Optimizer với learning rate = 0.001

Metrics đánh giá:

| Metric | Công thức | Ý nghĩa |
|:-------|:----------|:--------|
| Accuracy | (TP + TN) / Total | Tỷ lệ dự đoán đúng |
| Precision | TP / (TP + FP) | Độ chính xác của dự đoán dương |
| Recall | TP / (TP + FN) | Khả năng phát hiện đúng |

---

## 2.4 Lập trình kéo thả Blockly

Robot đã có "cơ thể" (phần cứng) và "bộ não" (AI phân loại), nhưng làm sao để người nông dân - những người không biết lập trình - có thể điều khiển nó? Đây là lúc Blockly phát huy vai trò.

### 2.4.1 Giới thiệu Blockly

Blockly là thư viện JavaScript mã nguồn mở do Google phát triển, cho phép tạo giao diện lập trình trực quan bằng cách kéo thả các khối lệnh như xếp LEGO. Thay vì viết code phức tạp, người dùng chỉ cần kéo các khối lệnh và ghép chúng lại với nhau. Theo Google Developers (2023), Blockly đã được sử dụng trong hơn 100 triệu dự án giáo dục trên toàn thế giới.

### 2.4.2 Ưu điểm của Blockly

| Đặc điểm | Lợi ích | Áp dụng trong đề tài |
|:---------|:--------|:---------------------|
| Trực quan | Không cần nhớ cú pháp | Người nông dân dễ tiếp cận |
| Ngăn lỗi cú pháp | Các khối chỉ ghép được khi hợp lệ | Giảm lỗi khi tạo kịch bản |
| Đa ngôn ngữ | Xuất code ra Python, JavaScript | Tích hợp với backend Flask |
| Tùy biến cao | Tạo khối lệnh riêng | Thiết kế block điều khiển robot |

### 2.4.3 Các khối lệnh tùy chỉnh trong đề tài

| Khối lệnh | Chức năng |
|:----------|:----------|
| Khi bắt đầu | Điểm khởi đầu chương trình |
| Di chuyển trục [X/Y/Z] | Điều khiển motor di chuyển |
| Bật/Tắt Relay | Điều khiển van hút |
| Chờ [n] giây | Tạm dừng chương trình |
| Về Home | Đưa cánh tay về vị trí gốc |
| Nếu nhãn là [...] | Kiểm tra kết quả phân loại |

---

## 2.5 Chatbot AI trong nông nghiệp

Ngoài giao diện Blockly, nhóm còn phát triển thêm một kênh tương tác thân thiện hơn nữa: Chatbot AI. Thay vì nhìn vào biểu đồ và con số, người nông dân có thể đơn giản hỏi "Hôm nay phân loại được bao nhiêu quả?" và nhận câu trả lời bằng tiếng Việt tự nhiên.

### 2.5.1 Xu hướng ứng dụng

Đây không phải ý tưởng mới - theo báo cáo của MarketsandMarkets (2023), thị trường AI trong nông nghiệp dự kiến đạt 4.7 tỷ USD vào năm 2028, với tốc độ tăng trưởng 25.4%/năm. Chatbot AI đang nổi lên như công cụ hỗ trợ nông dân tiếp cận công nghệ một cách tự nhiên nhất.

### 2.5.2 Mô hình ngôn ngữ lớn (LLM)

Hệ thống sử dụng Groq API với model GPT-OSS 120B:

| Đặc điểm | Thông số |
|:---------|:---------|
| Model | GPT-OSS 120B |
| Context Window | 128,000 tokens |
| Tốc độ xử lý | >500 tokens/giây (Groq LPU) |
| Ngôn ngữ | Hỗ trợ tiếng Việt |

### 2.5.3 Các tính năng Chatbot

| Tính năng | Ví dụ câu hỏi | Phản hồi mẫu |
|:----------|:--------------|:-------------|
| Thống kê | "Hôm nay phân loại được bao nhiêu?" | "Hôm nay: 523 quả (312 Premium, 156 Second, 55 Defective)" |
| Cảnh báo | "Có vấn đề gì không?" | "Tỷ lệ dưa lỗi tăng 15% so với hôm qua" |
| Hướng dẫn | "Làm sao tạo kịch bản mới?" | "Vào tab Blockly, kéo khối 'Bắt đầu'..." |
| Báo cáo | "Tổng hợp tuần này" | "Tuần này: 3,245 quả Premium, giá trị ~48.6 triệu VNĐ" |

---

## 2.6 Giao thức truyền thông

Cuối cùng, để tất cả các thành phần (Arduino, máy tính, điện thoại) có thể "nói chuyện" với nhau, cần có các giao thức truyền thông. Phần này giải thích cách dữ liệu được truyền đi trong hệ thống.

### 2.6.1 Serial Communication (UART)

Đây là giao thức truyền thông nối tiếp giữa máy tính và Arduino - "ngôn ngữ" để máy tính ra lệnh cho robot:

| Tham số | Giá trị | Mô tả |
|:--------|:-------:|:------|
| Baud rate | 115200 bps | Tốc độ truyền dữ liệu |
| Data bits | 8 | Số bit dữ liệu |
| Stop bits | 1 | Bit kết thúc |
| Parity | None | Không kiểm tra chẵn lẻ |

Định dạng lệnh điều khiển:
- M [dirX] [dirY] [dirZ] [duration] [speed] - Di chuyển
- R [state] - Điều khiển Relay
- H - Về Home Z
- HX - Về Home X
- C - Kiểm tra cảm biến

### 2.6.2 WebSocket

Giao thức full-duplex cho phép truyền dữ liệu hai chiều thời gian thực giữa Server (Flask) và Client (Web/Mobile) qua Port 5000.

Các sự kiện WebSocket:
- classification_result: Gửi kết quả phân loại
- robot_status: Cập nhật trạng thái robot
- error_alert: Thông báo lỗi
- stats_update: Cập nhật thống kê

### 2.6.3 REST API

| Endpoint | Method | Chức năng |
|:---------|:------:|:----------|
| /api/classify | POST | Phân loại ảnh dưa hấu |
| /api/robot/move | POST | Điều khiển robot |
| /api/stats | GET | Lấy thống kê |
| /api/scripts | GET/POST | Quản lý kịch bản |

---

## 2.7 Vai trò và ứng dụng của cánh tay robot

### 2.7.1 Vai trò trong công nghiệp hiện đại

Cánh tay robot đóng vai trò then chốt trong cuộc cách mạng công nghiệp 4.0, mang lại những lợi ích vượt trội:

| Vai trò | Mô tả | Ví dụ ứng dụng |
|:--------|:------|:---------------|
| **Tăng năng suất** | Hoạt động 24/7 không mệt mỏi | Dây chuyền lắp ráp ô tô |
| **Đảm bảo chất lượng** | Độ chính xác cao, ổn định | Hàn điểm, phun sơn |
| **Giảm chi phí** | Tiết kiệm nhân công lâu dài | Đóng gói, phân loại |
| **An toàn lao động** | Thay thế con người trong môi trường nguy hiểm | Xử lý hóa chất, nhiệt độ cao |
| **Linh hoạt** | Dễ lập trình lại cho tác vụ mới | Sản xuất đa dạng sản phẩm |

### 2.7.2 Ứng dụng trong nông nghiệp

Trong lĩnh vực nông nghiệp, cánh tay robot ngày càng được ứng dụng rộng rãi:

| Ứng dụng | Mô tả | Lợi ích |
|:---------|:------|:--------|
| Thu hoạch trái cây | Nhận diện và hái quả chín | Giảm hao hụt, tăng tốc độ |
| Phân loại nông sản | Phân loại theo kích thước, chất lượng | Chuẩn hóa sản phẩm xuất khẩu |
| Đóng gói | Xếp sản phẩm vào thùng/khay | Tăng năng suất đóng gói |
| Gieo trồng | Gieo hạt chính xác | Tiết kiệm giống, tăng tỷ lệ nảy mầm |
| Phun thuốc | Phun thuốc BVTV chính xác | Giảm lượng thuốc, bảo vệ môi trường |

**Áp dụng trong đề tài:** Hệ thống sử dụng cánh tay robot để phân loại dưa hấu - một ứng dụng thực tiễn giúp nâng cao giá trị nông sản Việt Nam.

---

## 2.8 Thách thức và tương lai của cánh tay robot công nghiệp

### 2.8.1 Những thách thức hiện tại

| Thách thức | Mô tả | Hướng giải quyết |
|:-----------|:------|:-----------------|
| **Chi phí đầu tư cao** | Robot công nghiệp giá từ vài trăm triệu đến vài tỷ VNĐ | Phát triển robot giá rẻ, mã nguồn mở |
| **Yêu cầu kỹ thuật cao** | Cần kỹ sư chuyên môn để vận hành, bảo trì | Giao diện đơn giản hóa (như Blockly) |
| **Thiếu linh hoạt** | Khó thích ứng với sản phẩm đa dạng | Tích hợp AI và Computer Vision |
| **An toàn** | Nguy hiểm khi làm việc gần người | Phát triển Cobot (Collaborative Robot) |
| **Bảo trì phức tạp** | Cần linh kiện chuyên dụng, đắt tiền | Thiết kế module hóa, dễ thay thế |

### 2.8.2 Xu hướng tương lai

1. **Robot cộng tác (Cobot):** Làm việc an toàn bên cạnh con người, không cần rào chắn
2. **Tích hợp AI:** Tự học và thích ứng với môi trường, tự điều chỉnh khi gặp lỗi
3. **Robot di động (AMR):** Kết hợp cánh tay với xe tự hành, linh hoạt di chuyển trong nhà máy
4. **Digital Twin:** Mô phỏng robot trên máy tính trước khi triển khai thực tế
5. **Robot-as-a-Service (RaaS):** Thuê robot theo tháng thay vì mua, giảm chi phí đầu tư ban đầu

### 2.8.3 Đóng góp của đề tài

Đề tài này đóng góp vào việc giải quyết một số thách thức:

| Thách thức | Giải pháp của đề tài |
|:-----------|:---------------------|
| Chi phí cao | Sử dụng linh kiện phổ thông, chi phí < 50 triệu VNĐ |
| Yêu cầu kỹ thuật | Giao diện Blockly kéo thả, không cần biết code |
| Thiếu linh hoạt | Tích hợp CNN để nhận diện đa dạng loại dưa |
| Khó tiếp cận | Chatbot AI hỗ trợ bằng tiếng Việt tự nhiên |

---

# CHƯƠNG 3: TRÌNH BÀY SẢN PHẨM

Chương này trình bày chi tiết quá trình xây dựng sản phẩm, từ nguyên liệu, dụng cụ cho đến các bước thực hiện cụ thể.

## 3.1 Nguyên liệu và dụng cụ chế tạo

### 3.1.1 Tổng quan kiến trúc hệ thống

Hệ thống được thiết kế theo kiến trúc 3 tầng, tách biệt rõ ràng giữa phần cứng, backend và giao diện người dùng:

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         TẦNG GIAO DIỆN (Frontend)                        │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐          │
│  │   Web Browser   │  │   Mobile App    │  │   Chatbot AI    │          │
│  │    (Blockly)    │  │ (React Native)  │  │  (GPT-OSS 120B) │          │
│  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘          │
└───────────┼─────────────────────┼─────────────────────┼──────────────────┘
            │ WebSocket/REST      │ REST API            │ Groq API
            ▼                     ▼                     ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         TẦNG XỬ LÝ (Backend)                            │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    Python Flask Server (Port 5000)               │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐            │   │
│  │  │ ML Model │ │ Script   │ │ Camera   │ │ History  │            │   │
│  │  │Controller│ │ Executor │ │Controller│ │Controller│            │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘            │   │
│  └─────────────────────────────┬───────────────────────────────────┘   │
└────────────────────────────────┼────────────────────────────────────────┘
                                 │ Serial COM (115200 baud)
                                 ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         TẦNG PHẦN CỨNG (Hardware)                        │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐          │
│  │  Arduino Uno    │  │   Robot Arm     │  │    Webcam       │          │
│  │  + CNC Shield   │──│ (3 NEMA 17)     │  │   (Camera)      │          │
│  │  + A4988 Driver │  │ + Vacuum Pump   │  │                 │          │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘          │
└─────────────────────────────────────────────────────────────────────────┘
```

**Luồng hoạt động chính:**

Khi hệ thống hoạt động, dữ liệu sẽ đi theo luồng sau:

1. **Camera** chụp ảnh dưa hấu → gửi lên **Backend**
2. **ML Controller** phân loại ảnh → trả về nhãn (Premium/Second/Defective)
3. **Script Executor** đọc kịch bản Blockly → gửi lệnh xuống **Arduino**
4. **Arduino** điều khiển **Robot** di chuyển đến vị trí tương ứng
5. **Relay** bật/tắt bơm hút → gắp và thả dưa vào thùng đúng
6. **WebSocket** cập nhật trạng thái real-time lên **Web/Mobile**

---

### 3.1.2 Danh sách linh kiện

**A. Module điều khiển:**

| STT | Linh kiện | Số lượng | Chức năng |
|:---:|:----------|:--------:|:----------|
| 1 | Arduino Uno R3 | 1 | Vi điều khiển chính |
| 2 | CNC Shield V3 | 1 | Board mở rộng điều khiển motor |
| 3 | Driver A4988 | 3 | Điều khiển động cơ bước |
| 4 | Nguồn 12V 5A | 1 | Cấp nguồn cho motor và relay |
| 5 | Biến áp 12V → 24V | 1 | Tăng áp cho máy bơm |

**B. Cơ cấu chấp hành:**

| STT | Linh kiện | Số lượng | Chức năng |
|:---:|:----------|:--------:|:----------|
| 1 | Động cơ bước NEMA 17 | 3 | Truyền động các khớp |
| 2 | Puly GT2 20 răng | 3 | Gắn trục motor |
| 3 | Dây đai GT2 200mm (vòng kín) | 3 | Truyền động |
| 4 | Máy bơm chân không 24V | 1 | Tạo lực hút |
| 5 | Giác hút (Suction Cup) | 1 | Gắp dưa hấu |
| 6 | Relay Module 12V | 1 | Đóng/ngắt bơm |

**C. Cảm biến và công tắc:**

| STT | Linh kiện | Số lượng | Chức năng |
|:---:|:----------|:--------:|:----------|
| 1 | Công tắc hành trình | 2 | Xác định vị trí Home (X, Z) |
| 2 | Cảm biến hồng ngoại | 2 | Báo thùng đầy (Loại 1, Loại 2) |
| 3 | Nút nhấn | 1 | Nút bấm hành động (A2) |
| 4 | Webcam USB | 1 | Thu nhận hình ảnh |

**D. Tụ điện (Lọc nhiễu - Rất quan trọng):**

| STT | Loại tụ | Thông số | Số lượng | Vị trí lắp |
|:---:|:--------|:---------|:--------:|:-----------|
| 1 | Tụ hóa (Electrolytic) | 100µF / 25V | 3 | Nguồn mỗi driver A4988 |
| 2 | Tụ hóa (Electrolytic) | 470µF / 25V | 2 | Đầu ra nguồn 5V tổng |
| 3 | Tụ gốm (Ceramic) | 104 (100nF) | 10 | VCC-GND cảm biến IR |

> **Lưu ý:** Môi trường có động cơ bước gây nhiễu nặng, tụ điện là **bắt buộc** để hệ thống hoạt động ổn định!

**E. Vòng bi (Bearings):**

| STT | Loại | Số lượng | Vị trí sử dụng |
|:---:|:-----|:--------:|:---------------|
| 1 | F686ZZ | 12 | Khớp vai, định vị tâm |
| 2 | F624ZZ | 8 | Khớp nối thanh truyền |
| 3 | 51105 | 2 | Đế xoay (chịu lực dọc trục) |

**F. Ốc vít:**

| Loại | Kích thước | Số lượng | Vị trí |
|:-----|:-----------|:--------:|:-------|
| M2 | 10mm + đai ốc | 10 bộ | Gắn công tắc hành trình |
| M3 | 6mm | 50 | Gắn motor, các chi tiết nhỏ |
| M4 | 10mm, 16mm, 20mm + đai ốc | 25 bộ | Kết nối khung, thanh truyền |
| M6 | 50mm + đai ốc | 2 | Trục xoay chính |

### 3.1.3 Thiết kế khung robot (in 3D)

Toàn bộ khung robot được in 3D bằng nhựa PLA/PETG, chia thành các cụm lắp ráp:

**A. Đế xoay (Base) - Chịu tải toàn bộ robot:**

| Chi tiết in 3D | Chức năng |
|:---------------|:----------|
| base_ring | Vòng đế ngoài cùng |
| socket | Đế giữ bạc đạn chính |
| base | Phần đế tam giác |
| rotategear | Bánh răng lớn để xoay đế |

Lắp ráp: Bạc đạn 51105 (chịu lực nén) + F686ZZ (định vị tâm) + 1 công tắc hành trình

**B. Thân robot (Body) - Chứa động cơ:**

| Chi tiết in 3D | Chức năng |
|:---------------|:----------|
| body_base | Đế thân chính |
| steppers | Khung giữ động cơ |
| upper_motor, lower_motor | Gá motor trên và dưới |
| endstop | Gá công tắc hành trình |

Lắp ráp: 2 động cơ NEMA 17 + 2 puly GT2 + 2 công tắc hành trình

**C. Hệ thống cánh tay (Arms):**

| Chi tiết in 3D | Chức năng |
|:---------------|:----------|
| lever | Đòn bẩy (cho cánh tay trên) |
| lowershank | Cánh tay dưới |
| Bánh răng in 3D | Truyền động từ motor |

Lắp ráp: Dây đai GT2 200mm + Bạc đạn F686ZZ tại khớp vai

**D. Hệ thống thanh truyền song song (Linkage):**

| Chi tiết in 3D | Chức năng |
|:---------------|:----------|
| triplate | Tấm tam giác nối thân và thanh truyền |
| pleuel | Thanh truyền dài |
| pleuel_bend_lower | Thanh truyền cong |
| upper_shank | Cánh tay trên cùng |

Lắp ráp: Bạc đạn F624ZZ + Ốc M4 16mm, 20mm

### 3.1.4 Sơ đồ kết nối điện

**A. Sơ đồ tổng quan hệ thống điện:**

```
                           ┌──────────────────────┐
                           │  12V DC Power Supply │
                           └──────────┬───────────┘
                                      │
                    Toggle Switch ────┤ (L1 → COM)
                         SPST         │
                                      │
        ┌─────────────────────────────┼─────────────────────────────────┐
        │                             │                                 │
        │ (+VE)                       │                                 │
        ▼                             ▼                                 │
┌───────────────┐            ┌────────────────┐                         │
│  CNC Shield   │◄───────────┤ Tụ hóa 100µF   │                         │
│  V3 (+VE)     │            │ /50V (lọc nguồn)│                         │
│               │            └────────────────┘                         │
│  ┌─────────┐  │                                                       │
│  │ A4988 X │◄─┼── Tụ gốm 104 (100nF)                                  │
│  │ A4988 Y │◄─┼── Tụ gốm 104 (100nF)                                  │
│  │ A4988 Z │◄─┼── Tụ gốm 104 (100nF)                                  │
│  └─────────┘  │                                                       │
│               │                                                       │
│     -VE ──────┼───────────────────────────────────────────────────────┘
└───────┬───────┘                              │ (Negative/GND chung)
        │                                      │
        │ Cắm lên Arduino                      │
        ▼                                      │
┌───────────────┐                              │
│  Arduino UNO  │                              │
└───────────────┘                              │
                                               │
┌──────────────────────────────────────────────┼─────────────────────────┐
│                                              │                         │
│  ┌────────────────┐    ┌────────────────┐    │    ┌────────────────┐   │
│  │  12V Relay     │    │ Tụ gốm 104     │    │    │ Step Down Buck │   │
│  │                │◄───┤ (lọc nhiễu)    │    │    │ LM2596         │   │
│  │  DC+ ◄─────────┼────┼────────────────┼────┘    │ 12V → 5V       │   │
│  │  DC- ◄─────────┼────┼───── GND ──────┼─────────┤ In -ve         │   │
│  │  IN  ◄─────────┼──── Z- (CNC Shield) │         │ In +ve ◄───────┼───┤
│  │  COM ──────────┼──►─┼── Air Valve VDD│         └───────┬────────┘   │
│  │  NO  ──────────┼──►─┼── +VE (12V)    │                 │            │
│  └────────────────┘    └────────────────┘                 │            │
│                                                           ▼            │
│                                              ┌────────────────────┐    │
│                                              │  5V DC Air Pump    │    │
│                                              │  +ve ◄── out +ve   │    │
│                                              │  -ve ◄── out -ve   │    │
│                                              └────────────────────┘    │
└────────────────────────────────────────────────────────────────────────┘
```

**B. Chi tiết kết nối Arduino UNO ↔ CNC Shield V3:**

| Chân Arduino | Chân CNC Shield | Chức năng |
|:------------:|:---------------:|:----------|
| D2 | X.STEP | Xung bước Motor X |
| D3 | Y.STEP | Xung bước Motor Y |
| D4 | Z.STEP | Xung bước Motor Z |
| D5 | X.DIR | Hướng Motor X |
| D6 | Y.DIR | Hướng Motor Y |
| D7 | Z.DIR | Hướng Motor Z |
| D8 | EN | Enable tất cả driver |
| D9 | Pin 7 (Y+) | IR Sensor 1 |
| D10 | Pin 6 (X+) | IR Sensor 2 |
| D11 | Pin 5 | Chưa sử dụng |
| D12 | SpnEn | Limit Switch Z (NO→C) |
| D13 | SpnDir | Limit Switch X (NO→C) |
| A2 | Resume | Nút nhấn (2Pin Push Switch) |
| GND | Pin 2, 20, 21 | Mass chung |
| 5V | Pin 19 | Nguồn 5V |
| 3.3V | Pin 18 | Nguồn 3.3V |
| Vin | Pin 22 | Nguồn vào |
| AREF | Pin 1 | Tham chiếu ADC |

**C. Chi tiết kết nối các thành phần:**

**1. Stepper Motors (3 động cơ NEMA 17):**

| Motor | Chân CNC Shield | Chân Motor |
|:-----:|:---------------:|:-----------|
| X | X1, X2, X3, X4 | D, B, C, A |
| Y | Y1, Y2, Y3, Y4 | D, B, C, A |
| Z | Z1, Z2, Z3, Z4 | D, B, C, A |

**2. Relay 12V (điều khiển Air Valve → Air Pump):**

| Chân Relay | Kết nối đến |
|:-----------|:------------|
| DC+ | CNC Shield +VE (12V) |
| DC- | CNC Shield -VE (GND) |
| IN | CNC Shield Z- |
| COM | Air Valve VDD + Tụ gốm 104 |
| NO | CNC Shield +VE (12V) |

**3. Cảm biến hồng ngoại (IR Sensor) - Nguồn 3.3V:**

| IR Sensor | Kết nối đến |
|:----------|:------------|
| Sensor 1 - out | CNC Shield Y+ (→ D9) |
| Sensor 2 - out | CNC Shield X+ (→ D10) |
| vcc | Multi-channel DC Module 3V3_OUT |
| gnd | Multi-channel DC Module GND |

**4. Công tắc hành trình (Limit Switch):**

| Limit Switch | Kết nối đến |
|:-------------|:------------|
| Z Limit - C, NO | CNC Shield SpnEn (D12) |
| X Limit - C, NO | CNC Shield SpnDir (D13) |

**5. Nút nhấn (2Pin Push Switch):**

| Chân | Kết nối đến |
|:-----|:------------|
| Input + | CNC Shield Resume (A2) |
| Output + | CNC Shield Resume (A2) |

**D. Danh sách tụ điện và vị trí lắp:**

| STT | Loại tụ | Thông số | SL | Vị trí lắp | Chức năng |
|:---:|:--------|:---------|:--:|:-----------|:----------|
| 1 | Tụ hóa (Electrolytic) | 100µF / 50V | 1 | CNC Shield +VE/-VE | Lọc nguồn chính 12V |
| 2 | Tụ gốm (Ceramic) | 104 (100nF) | 3 | Mỗi driver A4988 | Lọc nhiễu cao tần motor |
| 3 | Tụ gốm (Ceramic) | 104 (100nF) | 1 | Relay COM - GND | Lọc nhiễu relay |
| 4 | Tụ hóa (Electrolytic) | 470µF / 25V | 2 | Terminal Block (1,3 và 5,7) | Dự trữ năng lượng |

**E. Sơ đồ kết nối cảm biến IR (với nguồn 3.3V từ Multi-channel DC Module):**

```
┌─────────────────────────────────────────────────────────────────┐
│           Multi-channel DC Power Conversion Module              │
│  ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐  │
│  │3V3_OUT_1│3V3_OUT_2│3V3_OUT_3│5V_OUT_1 │5V_OUT_2 │   GND   │  │
│  └────┬────┴────┬────┴─────────┴─────────┴─────────┴────┬────┘  │
│       │         │                                       │       │
│       │         │              Tụ gốm 104               │       │
│       │         │              ┌─────┐                  │       │
│       ▼         ▼              │     │                  ▼       │
│  ┌─────────┐  ┌─────────┐      │     │            ┌─────────┐   │
│  │IR Sensor│  │IR Sensor│      │     │            │   GND   │   │
│  │    1    │  │    2    │      │     │            │  chung  │   │
│  │ vcc out │  │ vcc out │      │     │            │         │   │
│  │  │   │  │  │  │   │  │      │     │            │         │   │
│  └──┼───┼──┘  └──┼───┼──┘      │     │            └────┬────┘   │
│     │   │       │   │          │     │                 │        │
│   3.3V  │     3.3V  │          │     │                 │        │
│         │           │          │     │                 │        │
│         ▼           ▼          │     │                 │        │
│    CNC Shield   CNC Shield     │     │                 │        │
│       Y+           X+          │     │                 │        │
│    (→ D9)       (→ D10)        │     │                 │        │
└─────────────────────────────────┴─────┴─────────────────────────┘
```

**F. Sơ đồ mạch điều khiển Air Pump (5V DC):**

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│   12V DC ──┬──► CNC Shield (+VE) ──► 12V Relay (NO)                │
│   Power    │                              │                         │
│   Supply   │                              ▼                         │
│            │    ┌─────────────────────────────────────┐             │
│            │    │         12V Relay                    │             │
│            │    │  ┌─────┬─────┬─────┬─────┬─────┐    │             │
│            │    │  │ NO  │ COM │ NC  │ IN  │DC+/- │    │             │
│            │    │  └──┬──┴──┬──┴─────┴──┬──┴──┬───┘    │             │
│            │    │     │     │           │     │        │             │
│            │    └─────┼─────┼───────────┼─────┼────────┘             │
│            │          │     │           │     │                      │
│            └──────────┘     │      Z- (D11?)  │                      │
│                             │    (CNC Shield) │                      │
│                             ▼                 │                      │
│                      ┌──────────────┐         │                      │
│                      │  Air Valve   │◄── Tụ 104 (lọc nhiễu)         │
│                      │  VDD    GND  │         │                      │
│                      └───┬──────┬───┘         │                      │
│                          │      │             │                      │
│                          │      └─────────────┴──► GND (-VE)        │
│                          │                                          │
│                          ▼                                          │
│                   ┌─────────────────┐                               │
│                   │ Step Down Buck  │                               │
│                   │ LM2596 (12V→5V) │                               │
│                   │ in+  in-  out+  out- │                          │
│                   └──┬────┬────┬─────┬──┘                           │
│                      │    │    │     │                              │
│                   12V   GND    │     │                              │
│                   (từ Air      │     │                              │
│                    Valve)      ▼     ▼                              │
│                          ┌───────────────┐                          │
│                          │ 5V DC Air Pump │                          │
│                          │   +ve    -ve   │                          │
│                          └───────────────┘                          │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**G. Lưu ý quan trọng khi đấu nối:**

1. **Nguồn 12V:** Đi qua Toggle Switch SPST trước khi vào CNC Shield (+VE)
2. **Tụ lọc nguồn chính:** Tụ hóa 100µF/50V đấu giữa +VE và -VE của CNC Shield
3. **Tụ cho A4988:** Mỗi driver cần 1 tụ gốm 104 (100nF) đấu gần chân VMOT-GND
4. **Relay 12V:** Chân IN nối với Z- của CNC Shield, kích hoạt bằng mức LOW
5. **IR Sensor:** Dùng nguồn **3.3V** từ Multi-channel DC Module (không dùng 5V để tránh nhiễu)
6. **Limit Switch:** Đấu chân C và NO vào SpnEn/SpnDir, hoạt động theo INPUT_PULLUP
7. **Air Pump 5V:** Nguồn từ Step Down LM2596 (12V→5V), được điều khiển qua Relay + Air Valve
8. **Terminal Block:** Dùng để kết nối dây dễ dàng, có tụ hóa 470µF lọc nguồn

**H. Bảng tóm tắt kết nối theo chân CNC Shield V3:**

| Chân CNC Shield | Kết nối đến | Ghi chú |
|:----------------|:------------|:--------|
| +VE | 12V Power (qua Switch), Relay DC+, Relay NO, Tụ 100µF | Nguồn chính |
| -VE | 12V GND, Relay DC-, Air Valve GND, Buck In-, Tụ 100µF | Mass chung |
| X1-X4 | Motor X (D, B, C, A) | Stepper X |
| Y1-Y4 | Motor Y (D, B, C, A) | Stepper Y |
| Z1-Z4 | Motor Z (D, B, C, A) | Stepper Z |
| X+ | IR Sensor 2 out | Báo thùng đầy (→ D10) |
| Y+ | IR Sensor 1 out | Báo thùng đầy (→ D9) |
| Z- | Relay IN | Điều khiển bơm |
| SpnEn | Limit Switch Z (C, NO) | Home Z (D12) |
| SpnDir | Limit Switch X (C, NO) | Home X (D13) |
| Resume | Push Button (Input+, Output+) | Nút nhấn (A2) |

---

## 3.2 Các bước thực hiện

### 3.2.1 Xây dựng phần mềm Backend

**A. Cấu trúc thư mục:**

```
main/
├── app_ws.py              # Entry point - Flask + WebSocket server
├── config.py              # Cấu hình hệ thống (COM port, camera, ...)
├── requirements.txt       # Danh sách thư viện Python
│
├── controllers/           # Các module xử lý logic
│   ├── ml_controller.py       # Phân loại ảnh bằng CNN
│   ├── camera_controller.py   # Điều khiển webcam
│   ├── serial_controller.py   # Giao tiếp Arduino
│   ├── script_executor_ws.py  # Thực thi kịch bản Blockly
│   ├── history_controller.py  # Lưu lịch sử phân loại
│   └── bin_controller.py      # Quản lý trạng thái thùng chứa
│
├── routes/                # Định nghĩa API endpoints
│   ├── api_routes.py          # REST API
│   └── main_routes.py         # Render trang web
│
├── static/                # Frontend assets
│   ├── css/                   # Stylesheets
│   └── js/                    # JavaScript (Blockly, WebSocket client)
│
└── templates/             # HTML templates
    └── index.html             # Giao diện chính
```

**B. Thiết kế API:**

**REST API Endpoints:**

| Endpoint | Method | Mô tả | Request Body | Response |
|:---------|:------:|:------|:-------------|:---------|
| `/api/classify` | POST | Phân loại ảnh | `{image: base64}` | `{label, confidence}` |
| `/api/robot/move` | POST | Di chuyển robot | `{x, y, z, speed}` | `{status}` |
| `/api/robot/home` | POST | Về vị trí Home | - | `{status}` |
| `/api/relay` | POST | Bật/tắt bơm hút | `{state: 0/1}` | `{status}` |
| `/api/scripts` | GET | Lấy danh sách kịch bản | - | `[{id, name, code}]` |
| `/api/scripts` | POST | Lưu kịch bản mới | `{name, code}` | `{id}` |
| `/api/stats` | GET | Thống kê phân loại | - | `{premium, second, defective}` |
| `/api/history` | GET | Lịch sử phân loại | `?limit=100` | `[{timestamp, label}]` |

**WebSocket Events:**

| Event | Hướng | Mô tả |
|:------|:-----:|:------|
| `connect` | Client → Server | Kết nối WebSocket |
| `run_script` | Client → Server | Chạy kịch bản Blockly |
| `stop_script` | Client → Server | Dừng kịch bản |
| `script_progress` | Server → Client | Tiến độ thực thi |
| `classification_result` | Server → Client | Kết quả phân loại |
| `robot_status` | Server → Client | Trạng thái robot |
| `error` | Server → Client | Thông báo lỗi |

**C. Thiết kế Model Machine Learning:**

**Kiến trúc CNN:**

```
Input (224 × 224 × 3)
        │
        ▼
┌─────────────────────┐
│ Conv2D (32, 3×3)    │──► ReLU ──► MaxPool (2×2)
└─────────────────────┘
        │
        ▼
┌─────────────────────┐
│ Conv2D (64, 3×3)    │──► ReLU ──► MaxPool (2×2)
└─────────────────────┘
        │
        ▼
┌─────────────────────┐
│ Conv2D (128, 3×3)   │──► ReLU ──► MaxPool (2×2)
└─────────────────────┘
        │
        ▼
┌─────────────────────┐
│ Flatten             │
└─────────────────────┘
        │
        ▼
┌─────────────────────┐
│ Dense (128)         │──► ReLU ──► Dropout (0.5)
└─────────────────────┘
        │
        ▼
┌─────────────────────┐
│ Dense (3)           │──► Softmax
└─────────────────────┘
        │
        ▼
Output: [Premium, Second-grade, Defective]
```

**Thông số huấn luyện:**

| Tham số | Giá trị |
|:--------|:--------|
| Dataset | ~3000 ảnh (1000 ảnh/class) |
| Input size | 224 × 224 × 3 |
| Batch size | 32 |
| Epochs | 50 |
| Optimizer | Adam (lr=0.001) |
| Loss | Categorical Cross-Entropy |
| Validation split | 20% |

**D. Thiết kế giao diện Blockly:**

**Các khối lệnh tùy chỉnh:**

```javascript
// Khối "Khi bắt đầu"
Blockly.Blocks['on_start'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("🚀 Khi bắt đầu");
    this.setNextStatement(true, null);
    this.setColour(65);
  }
};

// Khối "Di chuyển"
Blockly.Blocks['move_motor'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("Di chuyển")
        .appendField(new Blockly.FieldDropdown([
          ["Đế xoay", "X"],
          ["Vai", "Y"], 
          ["Khuỷu", "Z"]
        ]), "AXIS")
        .appendField("hướng")
        .appendField(new Blockly.FieldDropdown([
          ["Thuận", "1"],
          ["Nghịch", "-1"]
        ]), "DIR")
        .appendField("thời gian")
        .appendField(new Blockly.FieldNumber(1000), "DURATION")
        .appendField("ms");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(230);
  }
};

// Khối "Bật/Tắt bơm hút"
Blockly.Blocks['relay_control'] = {
  init: function() {
    this.appendDummyInput()
        .appendField(new Blockly.FieldDropdown([
          ["🔴 Bật bơm hút", "1"],
          ["⚪ Tắt bơm hút", "0"]
        ]), "STATE");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(0);
  }
};

// Khối "Nếu nhãn là..."
Blockly.Blocks['check_label'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("Nếu nhãn là")
        .appendField(new Blockly.FieldDropdown([
          ["🥇 Premium", "Premium"],
          ["🥈 Second-grade", "Second-grade"],
          ["❌ Defective", "Defective"]
        ]), "LABEL");
    this.appendStatementInput("DO")
        .appendField("thì làm");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(210);
  }
};
```

---

### 3.2.2 Xây dựng Mobile App

**A. Cấu trúc ứng dụng:**

```
mobile_app/
├── App.js                 # Entry point
├── src/
│   ├── screens/           # Các màn hình
│   │   ├── ConnectScreen.js    # Kết nối server
│   │   ├── DashboardScreen.js  # Bảng điều khiển chính
│   │   ├── HistoryScreen.js    # Lịch sử phân loại
│   │   └── ChatbotScreen.js    # Chatbot AI
│   │
│   ├── components/        # Components tái sử dụng
│   │   └── NetworkStatus.js    # Hiển thị trạng thái mạng
│   │
│   ├── api/               # Gọi API
│   │   └── client.js           # Axios client
│   │
│   └── context/           # State management
│       └── AuthContext.js      # Quản lý kết nối
```

**B. Các màn hình chính:**

| Màn hình | Chức năng | Tính năng chính |
|:---------|:----------|:----------------|
| **ConnectScreen** | Kết nối với server | Nhập IP server, kiểm tra kết nối |
| **DashboardScreen** | Bảng điều khiển | Xem thống kê, điều khiển robot |
| **HistoryScreen** | Lịch sử phân loại | Xem lịch sử, lọc theo ngày/loại |
| **ChatbotScreen** | Trò chuyện với AI | Hỏi đáp, xem báo cáo |

**C. Tích hợp Chatbot AI:**

```javascript
// ChatbotScreen.js - Gọi Groq API
const sendMessage = async (userMessage) => {
  const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${GROQ_API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      model: 'gpt-oss-120b',
      messages: [
        {
          role: 'system',
          content: `Bạn là trợ lý AI cho hệ thống phân loại dưa hấu.
                    Dữ liệu hôm nay: ${JSON.stringify(todayStats)}
                    Trả lời ngắn gọn, thân thiện bằng tiếng Việt.`
        },
        { role: 'user', content: userMessage }
      ],
      max_tokens: 500
    })
  });
  
  return response.json();
};
```

---

### 3.2.3 Lập trình Arduino Firmware

**Cấu trúc code Arduino:**

```cpp
// main.ino - Firmware Arduino

// ===== ĐỊNH NGHĨA CHÂN =====
#define STEP_X 2    // Đế xoay
#define DIR_X  5
#define STEP_Y 3    // Vai
#define DIR_Y  6
#define STEP_Z 4    // Khuỷu
#define DIR_Z  7
#define ENABLE 8    // Enable tất cả driver
#define RELAY  12   // Bơm hút

#define LIMIT_X 9   // Công tắc hành trình đế
#define LIMIT_Y 10  // Công tắc hành trình vai
#define LIMIT_Z 11  // Công tắc hành trình khuỷu

// ===== BIẾN TOÀN CỤC =====
String inputString = "";
boolean stringComplete = false;

// ===== SETUP =====
void setup() {
  Serial.begin(115200);
  
  // Cấu hình output
  pinMode(STEP_X, OUTPUT); pinMode(DIR_X, OUTPUT);
  pinMode(STEP_Y, OUTPUT); pinMode(DIR_Y, OUTPUT);
  pinMode(STEP_Z, OUTPUT); pinMode(DIR_Z, OUTPUT);
  pinMode(ENABLE, OUTPUT);
  pinMode(RELAY, OUTPUT);
  
  // Cấu hình input (công tắc hành trình)
  pinMode(LIMIT_X, INPUT_PULLUP);
  pinMode(LIMIT_Y, INPUT_PULLUP);
  pinMode(LIMIT_Z, INPUT_PULLUP);
  
  digitalWrite(ENABLE, LOW);  // Bật driver
  digitalWrite(RELAY, LOW);   // Tắt bơm
  
  Serial.println("READY");
}

// ===== LOOP =====
void loop() {
  if (stringComplete) {
    processCommand(inputString);
    inputString = "";
    stringComplete = false;
  }
}

// ===== XỬ LÝ LỆNH =====
void processCommand(String cmd) {
  cmd.trim();
  char type = cmd.charAt(0);
  
  switch (type) {
    case 'M':  // Di chuyển: M dirX dirY dirZ duration speed
      handleMove(cmd);
      break;
    case 'R':  // Relay: R 0/1
      handleRelay(cmd);
      break;
    case 'H':  // Home
      if (cmd.length() > 1 && cmd.charAt(1) == 'X') {
        homeAxis('X');
      } else {
        homeAxis('Z');
      }
      break;
    case 'C':  // Check sensors
      checkSensors();
      break;
  }
}

// ===== DI CHUYỂN ĐỒNG BỘ 3 TRỤC =====
void handleMove(String cmd) {
  // Parse: M dirX dirY dirZ duration speed
  int params[5];
  parseParams(cmd, params, 5);
  
  int dirX = params[0], dirY = params[1], dirZ = params[2];
  int duration = params[3], speed = params[4];
  
  digitalWrite(DIR_X, dirX > 0 ? HIGH : LOW);
  digitalWrite(DIR_Y, dirY > 0 ? HIGH : LOW);
  digitalWrite(DIR_Z, dirZ > 0 ? HIGH : LOW);
  
  unsigned long startTime = millis();
  while (millis() - startTime < duration) {
    if (dirX != 0) { digitalWrite(STEP_X, HIGH); }
    if (dirY != 0) { digitalWrite(STEP_Y, HIGH); }
    if (dirZ != 0) { digitalWrite(STEP_Z, HIGH); }
    delayMicroseconds(speed);
    
    digitalWrite(STEP_X, LOW);
    digitalWrite(STEP_Y, LOW);
    digitalWrite(STEP_Z, LOW);
    delayMicroseconds(speed);
  }
  
  Serial.println("DONE");
}

// ===== ĐIỀU KHIỂN RELAY =====
void handleRelay(String cmd) {
  int state = cmd.substring(2).toInt();
  digitalWrite(RELAY, state ? HIGH : LOW);
  Serial.println(state ? "RELAY_ON" : "RELAY_OFF");
}

// ===== VỀ HOME =====
void homeAxis(char axis) {
  int stepPin, dirPin, limitPin;
  
  switch (axis) {
    case 'X': stepPin = STEP_X; dirPin = DIR_X; limitPin = LIMIT_X; break;
    case 'Y': stepPin = STEP_Y; dirPin = DIR_Y; limitPin = LIMIT_Y; break;
    case 'Z': stepPin = STEP_Z; dirPin = DIR_Z; limitPin = LIMIT_Z; break;
  }
  
  digitalWrite(dirPin, LOW);  // Hướng về Home
  
  // Di chuyển cho đến khi chạm công tắc
  while (digitalRead(limitPin) == HIGH) {
    digitalWrite(stepPin, HIGH);
    delayMicroseconds(500);
    digitalWrite(stepPin, LOW);
    delayMicroseconds(500);
  }
  
  Serial.println("HOME_" + String(axis));
}
```

---

# CHƯƠNG 4: KẾT LUẬN

## 4.1 Kết quả đạt được

### 4.1.1 Về mặt kỹ thuật

Sau quá trình nghiên cứu và phát triển, hệ thống phân loại dưa hấu đã đạt được những kết quả đáng ghi nhận:

| Tiêu chí | Mục tiêu đề ra | Kết quả đạt được | Đánh giá |
|:---------|:--------------:|:----------------:|:--------:|
| Độ chính xác phân loại | ≥ 85% | ~90% | ✅ Đạt |
| Thời gian xử lý/quả | < 5 giây | ~3-4 giây | ✅ Đạt |
| Tốc độ di chuyển robot | Ổn định | Mượt mà, không rung | ✅ Đạt |
| Hệ thống hút chân không | Hút chắc | Hút ổn định | ✅ Đạt |
| Giao tiếp Serial | Ổn định | Không mất gói tin | ✅ Đạt |

**Chi tiết kết quả:**

1. **Cánh tay robot Parallel Linkage:**
   - Thiết kế và chế tạo thành công cánh tay robot 3 bậc tự do
   - Cơ cấu Parallel Linkage đảm bảo End Effector luôn song song mặt đất
   - Vùng làm việc đủ rộng để phục vụ phân loại (bán kính ~25cm)
   - Hệ thống hút chân không 5V hoạt động ổn định với giác hút silicon

2. **Mô hình AI nhận diện:**
   - Huấn luyện thành công mô hình CNN với bộ dữ liệu dưa hấu Việt Nam
   - Phân loại được 2 loại: Dưa tốt (Loại 1) và Dưa xấu (Loại 2)
   - Mô hình được tối ưu với TensorFlow SavedModel, tích hợp dễ dàng
   - Sử dụng GPT-OSS 120B qua Groq API cho chatbot thông minh

3. **Phần mềm điều khiển:**
   - Backend Flask hoạt động ổn định với WebSocket realtime
   - Giao diện Blockly trực quan, dễ sử dụng
   - Mobile App React Native hỗ trợ giám sát từ xa
   - Chatbot AI tích hợp phản hồi bằng tiếng Việt tự nhiên

### 4.1.2 Về mặt ứng dụng thực tiễn

| Đối tượng | Lợi ích mang lại |
|:----------|:-----------------|
| **Nông dân** | Giảm công sức phân loại thủ công, tăng năng suất lao động |
| **Thương lái** | Đảm bảo chất lượng đồng đều, nâng cao giá trị thương mại |
| **Người dùng không chuyên** | Có thể tự lập trình robot qua Blockly mà không cần kiến thức lập trình |
| **Học sinh/Sinh viên** | Mô hình học tập về robotics, AI và IoT |

### 4.1.3 Về mặt giáo dục và lan tỏa

- **Mã nguồn mở:** Toàn bộ source code được chia sẻ trên GitHub để cộng đồng tham khảo
- **Tài liệu đầy đủ:** Hướng dẫn chi tiết từ lắp ráp phần cứng đến cài đặt phần mềm
- **Chi phí thấp:** Tổng chi phí linh kiện ~500.000 - 700.000 VNĐ, phù hợp với điều kiện Việt Nam
- **Khả năng mở rộng:** Thiết kế module hóa, dễ dàng nâng cấp và tùy biến

---

## 4.2 Hạn chế

### 4.2.1 Hạn chế về phần cứng

| Hạn chế | Nguyên nhân | Ảnh hưởng |
|:--------|:------------|:----------|
| Tải trọng giới hạn | Động cơ NEMA 17 công suất nhỏ | Chỉ phân loại dưa ≤ 3kg |
| Tốc độ chưa cao | Sử dụng động cơ bước thay vì servo | Thời gian chu kỳ ~3-4 giây/quả |
| Độ bền khung | Vật liệu nhựa in 3D (PLA/PETG) | Có thể biến dạng khi hoạt động lâu dài |
| Giác hút đơn giản | Chỉ có 1 giác hút silicon | Khó xử lý dưa có bề mặt không đều |

### 4.2.2 Hạn chế về phần mềm

| Hạn chế | Mô tả |
|:--------|:------|
| Bộ dữ liệu nhỏ | Mô hình CNN chỉ huấn luyện với ~1000 ảnh, cần thêm dữ liệu để tăng độ chính xác |
| Phụ thuộc ánh sáng | Nhận diện ảnh hưởng bởi điều kiện chiếu sáng môi trường |
| Chưa có phân loại đa lớp | Hiện chỉ phân 2 loại (tốt/xấu), chưa phân cấp chi tiết hơn |
| Chatbot cần internet | Sử dụng API Groq nên yêu cầu kết nối mạng |

### 4.2.3 Hạn chế về triển khai thực tế

- **Môi trường thử nghiệm:** Chỉ test trong điều kiện phòng lab, chưa triển khai ngoài đồng ruộng
- **Quy mô nhỏ:** Thiết kế cho nông hộ nhỏ, chưa phù hợp với dây chuyền công nghiệp lớn
- **Bảo trì:** Cần người có kiến thức cơ bản về điện tử để sửa chữa khi hỏng hóc

---

## 4.3 Hướng phát triển

### 4.3.1 Cải tiến ngắn hạn (3-6 tháng)

| Hạng mục | Giải pháp đề xuất | Kỳ vọng |
|:---------|:------------------|:--------|
| Tăng tải trọng | Thay NEMA 17 bằng NEMA 23 + driver TB6600 | Xử lý dưa đến 5kg |
| Cải thiện độ bền | Sử dụng vật liệu nhôm định hình hoặc in 3D bằng Carbon Fiber | Tuổi thọ tăng 3-5 lần |
| Mở rộng dữ liệu | Thu thập thêm 5000+ ảnh dưa hấu các loại | Độ chính xác ≥ 95% |
| Bổ sung cảm biến | Thêm cảm biến cân nặng và đo kích thước | Phân loại đa tiêu chí |

### 4.3.2 Phát triển trung hạn (6-12 tháng)

1. **Phân loại đa lớp:**
   - Phân thành nhiều cấp: Loại đặc biệt, Loại 1, Loại 2, Loại 3, Phế phẩm
   - Tích hợp nhận diện khuyết tật bề mặt (vết nứt, thối, sâu bệnh)

2. **Tích hợp IoT nâng cao:**
   - Kết nối với hệ thống quản lý nông trại (Farm Management System)
   - Đẩy dữ liệu lên cloud để phân tích big data
   - Cảnh báo qua SMS/Zalo khi có sự cố

3. **Cải tiến cơ khí:**
   - Thiết kế hệ thống băng tải tự động nạp dưa
   - Bổ sung thêm thùng chứa (3-4 loại thay vì 2)
   - Tích hợp hệ thống đóng gói tự động

### 4.3.3 Tầm nhìn dài hạn (1-3 năm)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    HỆ SINH THÁI NÔNG NGHIỆP THÔNG MINH                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌──────────────┐    ┌──────────────┐    ┌──────────────┐             │
│   │ Robot phân   │    │ Robot thu    │    │ Robot chăm   │             │
│   │ loại dưa hấu │◄──►│ hoạch tự động│◄──►│ sóc cây trồng│             │
│   └──────┬───────┘    └──────┬───────┘    └──────┬───────┘             │
│          │                   │                   │                      │
│          └───────────────────┼───────────────────┘                      │
│                              │                                          │
│                              ▼                                          │
│                    ┌─────────────────┐                                  │
│                    │  TRUNG TÂM      │                                  │
│                    │  ĐIỀU KHIỂN     │                                  │
│                    │  (AI + Cloud)   │                                  │
│                    └────────┬────────┘                                  │
│                             │                                           │
│          ┌──────────────────┼──────────────────┐                        │
│          │                  │                  │                        │
│          ▼                  ▼                  ▼                        │
│   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐                  │
│   │ Mobile App  │   │ Dashboard   │   │ Marketplace │                  │
│   │ (Nông dân)  │   │ (Quản lý)   │   │ (Thương mại)│                  │
│   └─────────────┘   └─────────────┘   └─────────────┘                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**Mục tiêu:**
- Xây dựng hệ sinh thái robot nông nghiệp hoàn chỉnh
- Mở rộng sang các loại nông sản khác: xoài, thanh long, bưởi, cam
- Thương mại hóa sản phẩm với giá thành cạnh tranh (< 10 triệu VNĐ/hệ thống)
- Hợp tác với các HTX nông nghiệp và doanh nghiệp xuất khẩu

### 4.3.4 Đóng góp cho cộng đồng

| Hoạt động | Mục đích |
|:----------|:---------|
| Open-source toàn bộ code | Cộng đồng có thể tham khảo, đóng góp và phát triển thêm |
| Workshop/Hội thảo | Chia sẻ kinh nghiệm, hướng dẫn tự chế tạo robot |
| Tài liệu tiếng Việt | Giúp học sinh, sinh viên Việt Nam tiếp cận công nghệ |
| Hợp tác nghiên cứu | Liên kết với các trường đại học, viện nghiên cứu |

---

## 4.4 Lời kết

Đề tài **"Hệ thống phân loại dưa hấu sử dụng cánh tay robot tích hợp Thị giác máy tính và Chatbot AI"** đã hoàn thành các mục tiêu đề ra ban đầu. Hệ thống không chỉ là một giải pháp kỹ thuật mà còn mang ý nghĩa xã hội sâu sắc – góp phần xóa bỏ khoảng cách giữa công nghệ hiện đại và người nông dân Việt Nam.

Qua quá trình thực hiện đề tài, nhóm đã học hỏi được rất nhiều kiến thức từ cơ khí, điện tử đến lập trình và trí tuệ nhân tạo. Đây là nền tảng quý giá để tiếp tục nghiên cứu và phát triển trong tương lai.

Chúng em xin chân thành cảm ơn quý thầy cô đã hướng dẫn tận tình, các bạn trong nhóm đã cùng nỗ lực, và gia đình đã luôn ủng hộ trong suốt quá trình thực hiện đề tài.

---

# PHỤ LỤC

## Phụ lục A: Mã nguồn Arduino (trích)

```cpp
// Các định nghĩa chân kết nối
#define stepPinX 2
#define stepPinY 3  
#define stepPinZ 4
#define dirPinX 5
#define dirPinY 6
#define dirPinZ 7
#define en 8
#define IR_SENSOR_1 9    // Y+ trên CNC Shield
#define IR_SENSOR_2 10   // X+ trên CNC Shield
#define RELAY_PIN 11     // Z- trên CNC Shield
#define Z_LIMIT_PIN 12   // SpnEn
#define X_LIMIT_PIN 13   // SpnDir
#define BTN_ACTION A2    // Resume
```

## Phụ lục B: Cấu hình Backend Python (trích)

```python
# config.py
SERIAL_PORT = 'COM3'       # Cổng kết nối Arduino
SERIAL_BAUDRATE = 115200   # Tốc độ truyền
MODEL_PATH = '../model.savedmodel'  # Đường dẫn mô hình AI
GROQ_API_KEY = 'gsk_xxxxx'  # API key cho chatbot
```

## Phụ lục C: Danh sách khối Blockly

| Khối | Chức năng | Lệnh gửi đến Arduino |
|:-----|:----------|:--------------------|
| Di chuyển đến XYZ | Điều khiển vị trí | `MOVE:X,Y,Z` |
| Bật/Tắt bơm | Điều khiển relay | `PUMP:ON/OFF` |
| Về vị trí Home | Reset vị trí | `HOME:X/Y/Z` |
| Chờ (ms) | Delay | `DELAY:time` |
| Phân loại tự động | Kích hoạt AI | `AUTO:START` |

## Phụ lục D: Sơ đồ chân CNC Shield V3

| Pin Header | Chức năng | Arduino Pin |
|:-----------|:----------|:-----------|
| X.STEP | Xung bước Motor X | D2 |
| Y.STEP | Xung bước Motor Y | D3 |
| Z.STEP | Xung bước Motor Z | D4 |
| X.DIR | Hướng Motor X | D5 |
| Y.DIR | Hướng Motor Y | D6 |
| Z.DIR | Hướng Motor Z | D7 |
| EN | Enable drivers | D8 |
| X+ | Limit/Sensor | D10 |
| Y+ | Limit/Sensor | D9 |
| Z- | Relay control | D11 |
| SpnEn | Limit Z | D12 |
| SpnDir | Limit X | D13 |
| Resume | Button | A2 |

---

# TÀI LIỆU THAM KHẢO

## Sách và tài liệu học thuật

[1] Szeliski, R. (2022). *Computer Vision: Algorithms and Applications, 2nd Edition*. Springer.

[2] LeCun, Y., Bengio, Y., & Hinton, G. (2015). Deep Learning. *Nature*, 521(7553), 436-444.

[3] Siciliano, B., & Khatib, O. (2016). *Springer Handbook of Robotics, 2nd Edition*. Springer.

[4] Craig, J. J. (2018). *Introduction to Robotics: Mechanics and Control, 4th Edition*. Pearson.

## Báo cáo và thống kê

[5] FAO (2022). *FAOSTAT - Crops and livestock products*. Food and Agriculture Organization of the United Nations.

[6] Viện Cây ăn quả Miền Nam - SOFRI (2023). *Báo cáo tình hình sản xuất trái cây vùng ĐBSCL*.

[7] Hiệp hội Rau quả Việt Nam (2023). *Báo cáo xuất khẩu rau quả năm 2023*.

[8] Tổng cục Thống kê (2022). *Niên giám thống kê nông nghiệp*.

[9] International Federation of Robotics - IFR (2023). *World Robotics Report 2023*.

[10] McKinsey & Company (2023). *Digital Agriculture: The future of farming in Asia*.

[11] MarketsandMarkets (2023). *AI in Agriculture Market - Global Forecast to 2028*.

## Tài liệu kỹ thuật

[12] Arduino Documentation. *Arduino Uno Rev3 Datasheet*. https://docs.arduino.cc/hardware/uno-rev3

[13] Pololu. *A4988 Stepper Motor Driver Carrier*. https://www.pololu.com/product/1182

[14] Texas Instruments. *LM2596 SIMPLE SWITCHER Power Converter Datasheet*.

[15] Espressif Systems. *ESP32 Technical Reference Manual*.

## Tài liệu phần mềm

[16] Flask Documentation. *Flask-SocketIO*. https://flask-socketio.readthedocs.io/

[17] TensorFlow. *SavedModel Guide*. https://www.tensorflow.org/guide/saved_model

[18] React Native Documentation. *Getting Started*. https://reactnative.dev/docs/getting-started

[19] Google Developers (2023). *Blockly Developer Documentation*. https://developers.google.com/blockly

[20] Groq Inc. (2024). *Groq API Documentation*. https://console.groq.com/docs

## Website tham khảo

[21] OpenCV Documentation. https://docs.opencv.org/

[22] Python Documentation. https://docs.python.org/3/

[23] MDN Web Docs. *WebSocket API*. https://developer.mozilla.org/en-US/docs/Web/API/WebSocket

---

**© 2024-2025 - Đề tài Ngày hội Kỹ thuật - Đại học Bách Khoa TP.HCM**
